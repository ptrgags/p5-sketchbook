<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      language="javascript"
      type="text/javascript"
      src="../../libraries/p5.min.js"
    ></script>
    <script src="https://unpkg.com/tone@15.0.4/build/Tone.js"></script>
    <script type="module">
      import { sketch } from "./SoundTest.js";
      import "../../sketchlib/sketchbook-navbar.js";
      const p5_sketch = new p5(sketch, "sketch");
    </script>
    <link rel="stylesheet" href="../../styles/layout.css" />
  </head>
  <body>
    <sketchbook-navbar></sketchbook-navbar>
    <div class="container">
      <h1>ðŸ§ªSound Test (2025)</h1>
      <div class="sketch">
        <canvas id="sketch-canvas" width="500" height="700"></canvas>
      </div>
      <div class="controls">
        <div style="display: none">
          <label for="import">Import MIDI (.mid) file</label>
          <br />
          <input
            type="file"
            name="import"
            id="import"
            accept="audio/mid"
            disabled
          />
          <p class="errors" id="errors"></p>
        </div>
        <br />
        <button id="export_clips" disabled>Export MIDI Clips</button>
        <button id="export_gm" disabled>Export for General MIDI</button>
      </div>
      <div class="description">
        <p>
          Press play, then click the buttons to select between the different
          melodies.
        </p>
        <p>
          This lab sketch is a test area for adding music to my visualizations.
          It's a sort of jukebox and visualizer to try out musical ideas.
        </p>
        <p>
          The intent is to make a system that lets me write music with code. The
          musical scores can then be played back with Tone.js. A recent addition
          is the ability to store animation parameters and cues with the score.
          This way, I can make animations that are always in sync with the beat.
        </p>
        <p>
          See the
          <a
            href="https://github.com/ptrgags/p5-sketchbook/blob/main/lab/lablib/music/README.md"
            >Music README</a
          >
          for more details on the musical algebra representation I'm using as
          well as the books/articles its inspired by.
        </p>
        <details>
          <summary>Changelog</summary>
          <dl>
            <dt>2025-12-31</dt>
            <dd>
              Added a button to export the current score to a MIDI file. This
              gives me a way to export the score and record a nicer version in a
              DAW.
            </dd>
            <dt>2025-11-26</dt>
            <dd>
              <p>
                I added a way to describe parameters that change in time with
                the music. This is something along the lines of automation
                curves in a DAW, but expressed as a Timeline (see the
                <a
                  href="https://github.com/ptrgags/p5-sketchbook/blob/main/lab/lablib/music/README.md"
                  >Music README</a
                >). To try it out, I added the "spiral burst" animation. This
                acts as a visual metronome - bursting on the downbeat, and every
                beat after it the colors change.
              </p>
              <p>
                I also reworked the musical timeline visualization to look more
                like how you would expect in a DAW. This makes it more readable.
              </p>
            </dd>
            <dt>2025-11-22</dt>
            <dd>
              I'm working on adding ways to have animations synced with the
              background music. As a first experiment, I have the music system
              triggering events every time a note starts/ends. As a first test,
              I made the visual piano keyboard which lights up as notes are
              played.
            </dd>
            <dt>2025-05-28</dt>
            <dd>
              I added a visualization of the musical timeline to give a rough
              idea of the structure of the music.
            </dd>
            <dt>2025-05-14</dt>
            <dd>
              I added a third melody that takes a short motif and transforms it
              into a larger musical work using transposition and retrograde.
            </dd>
            <dt>2025-05-13</dt>
            <dd>
              I started implementing algebraic music types based on
              <cite>The Haskell School of Music</cite> by Paul Hudak and Donya
              Quick, <cite>A Geometry of Music</cite> bu Dmitri Tymoczko, and
              some concepts from
              <a href="https://tidalcycles.org/docs/reference/cycles"
                >Tidal Cycles</a
              >. See the
              <a
                href="https://github.com/ptrgags/p5-sketchbook/blob/main/lab/lablib/music/README.md"
                >Music README</a
              >
              for more details.
            </dd>
          </dl>
        </details>
      </div>
    </div>
  </body>
</html>
